# MCLocalAuth v1.3.0

**Type:** Mise à jour majeure  
**Date:** 22 Octobre 2025

---

## ✨ Nouveautés

### 🎮 Commande Discord renommée

**Nouvelle commande:** `/mclogin <code>`  
**Ancienne commande:** `/auth <code>`

Tous les messages et références ont été mis à jour pour utiliser `/mclogin`.

**Exemple d'utilisation:**
```
/mclogin 123456
```

---

### 🔓 Commande /unlink (Admin)

Nouvelle commande réservée aux administrateurs pour délier un compte Discord.

**Utilisation:** `/unlink <discord_id>`

**Permissions:**
- Réservé à l'admin configuré dans `config.yml` (`admin.discord_id`)
- Journalise toutes les tentatives dans les logs

**Note:** Fonctionnalité de base implémentée. L'implémentation complète avec liaison Discord persistante arrive prochainement.

---

## 🔧 Corrections

### 📝 Encodage UTF-8 corrigé (in-game)

**Problème résolu:** Messages in-game avec caractères bizarres

**Avant:**
```
[MCLocalAuth] PvP_UNGEUR a réinitialisé les IP de PvP_UNGEUR
                           ^^^^^^^^^^^^^^^^^^
```

**Après:**
```
[MCLocalAuth] PvP_UNGEUR a reinitialise les IP de PvP_UNGEUR
```

**Tous les messages corrigés:**
- "réinitialisé" → "reinitialise"
- "ajouté" → "ajoute"
- "supprimé" → "supprime"
- "défini" → "defini"
- "autorisées" → "autorisees"

---

### 🌐 Support IPv6

Les adresses IPv6 sont maintenant acceptées pour les IP autorisées !

**Avant:** Seules les IPv4 étaient validées (ex: `192.168.1.1`)  
**Après:** IPv4 ET IPv6 supportées (ex: `2001:0db8:85a3::8a2e:0370:7334`)

**Commandes affectées:**
- `/auth addip <joueur> <ip>`
- `/auth setip <joueur> <ip>`

La validation utilise maintenant `InetAddress.getByName()` pour supporter les deux formats.

---

### 🔍 IP actuelle affichée dans kick

Quand un joueur est kick pour mauvaise IP, le message affiche maintenant son IP actuelle.

**Message de kick:**
```
§cConnexion refusee: Votre IP n'est pas autorisee pour ce compte.

§7Votre IP: §f123.45.67.89

§eContactez un administrateur si vous jouez depuis un nouvel endroit.
```

La variable `%current_ip%` est maintenant correctement remplacée dans `config.yml`.

---

## 📦 Modifications techniques

### Fichiers modifiés

**Java:**
- `AuthAdminCommand.java` - Encodage + validation IPv6
- `LoginListener.java` - Affichage IP actuelle + encodage
- `DiscordBot.java` - Renommage /auth → /mclogin
- `DiscordCommandListener.java` - Handler /mclogin + /unlink admin

**Configuration:**
- `config.yml` - Messages sans accents + `/mclogin`
- `plugin.yml` - Version 1.3.0
- `pom.xml` - Version 1.3.0

---

## 🔄 Migration depuis v1.2.x

**Étapes:**

1. **Arrêter le serveur**
2. **Remplacer** le JAR par `MCLocalAuth-Spigot-v1.3.0.jar`
3. **Configurer admin** (nouveau) dans `config.yml`:
   ```yaml
   admin:
     discord_id: "TON_DISCORD_ID"  # Pour /unlink
     minecraft_uuid: ""              # Optionnel
   ```
4. **Redémarrer le serveur**
5. **Informer les joueurs** : La commande est maintenant `/mclogin <code>`

**Note:** L'ancienne configuration reste compatible. Les messages seront automatiquement mis à jour.

---

## 📋 Changements visibles pour les joueurs

### Sur Discord

**Avant:**
```
/auth 123456
```

**Maintenant:**
```
/mclogin 123456
```

### Dans Minecraft

**Message de connexion:**
```
Sur Discord, tapez: /mclogin 870600
```
(au lieu de `/auth PvP_UNGEUR 870600`)

---

## 🛡️ Sécurité

### Logging administrateur

Toutes les actions admin sont maintenant loggées:

```
[ADMIN] PvP_UNGEUR#1234 a tente de delier le Discord ID: 987654321
```

Utile pour auditer les actions sensibles.

---

## 📊 Compatibilité

✅ **Minecraft:** 1.8 → 1.21+  
✅ **Java:** 8+  
✅ **IPv4 & IPv6:** Supportés  
✅ **Config:** Compatible v1.2.x (ajout automatique section admin)

---

## 🐛 Bugs connus

Aucun bug connu à ce jour.

**Si vous rencontrez un problème:**
1. Vérifiez que vous utilisez v1.3.0
2. Vérifiez les logs du serveur
3. Ouvrez une issue sur GitHub

---

## 💡 Commandes Discord (mise à jour)

| Commande | Description | Permissions |
|----------|-------------|-------------|
| `/mclogin <code>` | S'authentifier avec le code | Tous |
| `/mctest` | Tester connexion bot/plugin | Tous |
| `/status` | Vérifier son statut | Tous |
| `/unlink <discord_id>` | Délier un compte | **Admin uniquement** |

---

## ⚙️ Installation

1. Télécharger `MCLocalAuth-Spigot-v1.3.0.jar`
2. Placer dans `plugins/`
3. Redémarrer le serveur
4. Configurer `admin.discord_id` dans `config.yml`
5. Tester avec `/mctest` et `/mclogin`

---

**Taille:** 10.68 MB  
**Build:** Maven 3.9.5 + Java 8  
**Statut:** STABLE ✅
