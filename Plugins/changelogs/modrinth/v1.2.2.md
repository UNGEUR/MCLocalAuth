# MCLocalAuth v1.2.2

**Type:** Fix critique  
**Date:** 21 Octobre 2025

---

## 🐛 Bug critique corrigé

### Code toujours invalide

**Problème:**
- Joueur se connecte → Reçoit code
- Joueur tape `/auth <code>` sur Discord
- Bot répond: "Code invalide"
- **Même avec le bon code !**

---

## 🔍 Cause

L'ancien code cherchait dans `Bukkit.getOnlinePlayers()`

**Mais:**
- Quand joueur est kick pour auth → N'est PLUS dans `getOnlinePlayers()` !
- Code existe dans `PendingManager`
- Mais joueur introuvable !

---

## ✅ Solution

### Nouvelle méthode `findByCode()`

Ajout dans `PendingManager.java`:

```java
public PendingEntry findByCode(String code) {
    cleanupExpired();
    for (PendingEntry entry : pending.values()) {
        if (entry.code.equals(code)) {
            return entry;
        }
    }
    return null;
}
```

### Modification dans `DiscordCommandListener.java`

**Avant:**
```java
for (Player onlinePlayer : Bukkit.getOnlinePlayers()) {
    if (pendingManager.isPending(...)) { ... }
}
```

**Après:**
```java
PendingEntry entry = pendingManager.findByCode(code);
if (entry != null) { ... }
```

---

## 🎉 Résultat

L'authentification fonctionne maintenant:

1. ✅ Connexion Minecraft → Code généré
2. ✅ Kick automatique → Code reste dans PendingManager
3. ✅ `/auth <code>` sur Discord → Trouve le code !
4. ✅ Authentification réussie → Reconnexion autorisée

---

## 📦 Installation

1. Remplacer par `MCLocalAuth-Spigot-v1.2.2.jar`
2. Redémarrer serveur
3. Tester authentification complète

---

**Taille:** 10.68 MB  
**Statut:** STABLE ✅
